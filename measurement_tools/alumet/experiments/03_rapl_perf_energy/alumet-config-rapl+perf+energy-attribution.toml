[plugins.csv]
output_path = "alumet-output-rapl+perf+energy-attribution.csv"
force_flush = true
append_unit_to_metric_name = true
use_unit_display_name = true
csv_delimiter = ";"
csv_late_delimiter = ","

[plugins.procfs.kernel]
enabled = true
poll_interval = "20ms"

[plugins.procfs.memory]
enabled = true
poll_interval = "20ms"
metrics = [
    "MemTotal",
    "MemFree",
    "MemAvailable",
    "Cached",
    "SwapCached",
    "Active",
    "Inactive",
    "Mapped",
]

[plugins.procfs.processes]
enabled = true
refresh_interval = "20ms"
strategy = "event"

[[plugins.procfs.processes.groups]]
exe_regex = ""
poll_interval = "20ms"
flush_interval = "2s"

[plugins.procfs.processes.events]
poll_interval = "20ms"
flush_interval = "2s"


[plugins.rapl]
poll_interval = "20ms"
flush_interval = "2s"
no_perf_events = false

[plugins.perf]
# Description.
poll_interval = "20ms"
flush_interval = "2s"
hardware_events = [
    "CPU_CYCLES",
    "INSTRUCTIONS",
    "CACHE_REFERENCES",
    "CACHE_MISSES",
    "BRANCH_INSTRUCTIONS",
    "BRANCH_MISSES",
    "BUS_CYCLES",
    "REF_CPU_CYCLES"
]

software_events = [
    "PAGE_FAULTS",
    "CONTEXT_SWITCHES",
    "CPU_MIGRATIONS",
    "PAGE_FAULTS_MIN",
    "PAGE_FAULTS_MAJ",
    "ALIGNMENT_FAULTS",
    "EMULATION_FAULTS",
    "CGROUP_SWITCHES"
]
cache_events = [
]

[plugins.energy-attribution.formulas.attributed_energy]
# the expression used to compute the final value
expr = "cpu_energy * cpu_usage / 100.0"
# the time reference: this is a timeseries, defined by a metric (and other criteria, see below), that will not change during the transformation. Other timeseries can be interpolated in order to have the same timestamps before applying the formula.
ref = "cpu_energy"

# Timeseries related to the resources.
[plugins.energy-attribution.formulas.attributed_energy.per_resource]
# Defines the timeseries `cpu_energy` that is used in the formula, as the measurement points that have:
# - the metric `rapl_consumed_energy`,
# - and the resource kind `"local_machine"`
# - and the attribute `domain` equal to `package_total`
cpu_energy = { metric = "rapl_consumed_energy", resource_kind = "local_machine", domain = "package_total" }

# Timeseries related to the resource consumers.
[plugins.energy-attribution.formulas.attributed_energy.per_consumer]
# Defines the timeseries `cpu_usage` that is used in the formula, as the measurements points that have:
# - the metric `cpu_percent`
# - the attribute `kind` equal to `total`
cpu_usage = { metric = "cpu_percent", kind = "total" }
